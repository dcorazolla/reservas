openapi: 3.0.3
info:
  title: Reservas API
  version: 1.0.0
  description: API para gestão de reservas, tarifas e disponibilidade.
servers:
  - url: http://localhost:8000/api
    description: Local
tags:
  - name: Authorization
    description: Autenticação e sessões
  - name: Calendar
    description: Visão de calendário
  - name: Reservations
    description: Operações de reservas
  - name: Availability
    description: Busca de disponibilidade e preços
  - name: Rooms
    description: Gestão de quartos
  - name: Room Categories
    description: Gestão de categorias de quartos
  - name: Property Pricing
    description: Tarifário padrão da propriedade
  - name: Properties
    description: Gestão de propriedades
  - name: Room Rates
    description: Tarifas base por quarto
  - name: Room Rate Periods
    description: Tarifas por período por quarto
  - name: Category Rates
    description: Tarifas base por categoria
  - name: Category Rate Periods
    description: Tarifas por período por categoria
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    PropertyInput:
      type: object
      required: [name, timezone]
      properties:
        name: { type: string }
        timezone: { type: string }
        infant_max_age: { type: integer, nullable: true }
        child_max_age: { type: integer, nullable: true }
        child_factor: { type: number, nullable: true }
        base_one_adult: { type: number, nullable: true }
        base_two_adults: { type: number, nullable: true }
        additional_adult: { type: number, nullable: true }
        child_price: { type: number, nullable: true }
security:
  - bearerAuth: []
paths:
  /auth/login:
    post:
      tags: [Authorization]
      summary: Login
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string, format: email }
                password: { type: string }
      responses:
        '200':
          description: Tokens
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token: { type: string }
                  refresh_token: { type: string }
                  token_type: { type: string }
                  expires_in: { type: integer }
  /auth/refresh:
    post:
      tags: [Authorization]
      summary: Renovar token de acesso
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [refresh_token]
              properties:
                refresh_token: { type: string }
      responses:
        '200':
          description: Token renovado
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token: { type: string }
                  refresh_token: { type: string }
                  token_type: { type: string }
                  expires_in: { type: integer }
  /auth/me:
    get:
      tags: [Authorization]
      summary: Dados do usuário
      responses:
        '200': { description: Usuário }
  /auth/logout:
    post:
      tags: [Authorization]
      summary: Logout atual
      responses:
        '204': { description: Sem conteúdo }
  /auth/logout-all:
    post:
      tags: [Authorization]
      summary: Revoga todas sessões
      responses:
        '204': { description: Sem conteúdo }
  /calendar:
    get:
      tags: [Calendar]
      summary: Calendário
      responses:
        '200': { description: Dias e reservas }
  /reservations:
    post:
      tags: [Reservations]
      summary: Criar reserva
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [room_id, guest_name, start_date, end_date, adults_count, children_count]
              properties:
                room_id: { type: string, format: uuid }
                guest_name: { type: string }
                email: { type: string, nullable: true }
                phone: { type: string, nullable: true }
                adults_count: { type: integer }
                children_count: { type: integer }
                infants_count: { type: integer, nullable: true }
                start_date: { type: string, format: date }
                end_date: { type: string, format: date }
                notes: { type: string, nullable: true }
      responses:
        '201': { description: Reserva criada }
  /reservations/{reservation}:
    get:
      tags: [Reservations]
      summary: Detalhe da reserva
      parameters:
        - in: path
          name: reservation
          schema: { type: string, format: uuid }
          required: true
      responses:
        '200': { description: Reserva }
    put:
      tags: [Reservations]
      summary: Atualizar reserva
      parameters:
        - in: path
          name: reservation
          schema: { type: string, format: uuid }
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200': { description: Reserva atualizada }
  /reservations/calculate:
    post:
      tags: [Reservations]
      summary: Calcular preço (modo simples)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [room_id, start_date, end_date, people_count]
              properties:
                room_id: { type: string, format: uuid }
                start_date: { type: string, format: date }
                end_date: { type: string, format: date }
                people_count: { type: integer }
      responses:
        '200': { description: Preço calculado }
  /availability/search:
    post:
      tags: [Availability]
      summary: Busca disponibilidade com preço detalhado
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [checkin, checkout, adults, children]
              properties:
                checkin: { type: string, format: date }
                checkout: { type: string, format: date }
                adults: { type: integer }
                children: { type: integer }
                infants: { type: integer, nullable: true }
                property_ids:
                  type: array
                  items: { type: string, format: uuid }
      responses:
        '200': { description: Lista de quartos com preços }
  /rooms:
    get:
      tags: [Rooms]
      summary: Lista de quartos
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
      responses:
        '200': { description: Quartos }
    post:
      tags: [Rooms]
      summary: Criar quarto
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '201': { description: Criado }
  /rooms/{room}:
    get:
      tags: [Rooms]
      summary: Detalhe do quarto
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
        - in: path
          name: room
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200': { description: Quarto }
    put:
      tags: [Rooms]
      summary: Atualizar quarto
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
        - in: path
          name: room
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200': { description: Atualizado }
    delete:
      tags: [Rooms]
      summary: Excluir quarto
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
        - in: path
          name: room
          required: true
          schema: { type: string, format: uuid }
      responses:
        '204': { description: Excluído }
  /room-categories:
    get:
      tags: [Room Categories]
      summary: Lista de categorias
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
      responses:
        '200': { description: Categorias }
    post:
      tags: [Room Categories]
      summary: Criar categoria
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '201': { description: Criado }
  /room-categories/{category}:
    get:
      tags: [Room Categories]
      summary: Detalhe da categoria
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
        - in: path
          name: category
          schema: { type: string, format: uuid }
          required: true
      responses:
        '200': { description: Categoria }
    put:
      tags: [Room Categories]
      summary: Atualizar categoria
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
        - in: path
          name: category
          schema: { type: string, format: uuid }
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200': { description: Atualizado }
    delete:
      tags: [Room Categories]
      summary: Excluir categoria
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
        - in: path
          name: category
          schema: { type: string, format: uuid }
          required: true
      responses:
        '204': { description: Excluído }
  /properties/pricing:
    get:
      tags: [Property Pricing]
      summary: Tarifário padrão da propriedade
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
      responses:
        '200':
          description: Valores atuais
          content:
            application/json:
              schema:
                type: object
                properties:
                  base_one_adult: { type: number, nullable: true }
                  base_two_adults: { type: number, nullable: true }
                  additional_adult: { type: number, nullable: true }
                  child_price: { type: number, nullable: true }
                  infant_max_age: { type: integer, nullable: true }
                  child_max_age: { type: integer, nullable: true }
                  child_factor: { type: number, nullable: true }
    put:
      tags: [Property Pricing]
      summary: Atualizar tarifário padrão
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                base_one_adult: { type: number, nullable: true }
                base_two_adults: { type: number, nullable: true }
                additional_adult: { type: number, nullable: true }
                child_price: { type: number, nullable: true }
                infant_max_age: { type: integer, nullable: true }
                child_max_age: { type: integer, nullable: true }
                child_factor: { type: number, nullable: true }
      responses:
        '200': { description: Atualizado }

  /properties:
    get:
      tags: [Properties]
      summary: Lista de propriedades
      responses:
        '200': { description: Propriedades }
    post:
      tags: [Properties]
      summary: Criar propriedade
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PropertyInput'
      responses:
        '201': { description: Criado }
  /properties/{property}:
    get:
      tags: [Properties]
      summary: Detalhe da propriedade
      parameters:
        - in: path
          name: property
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200': { description: Propriedade }
    put:
      tags: [Properties]
      summary: Atualizar propriedade
      parameters:
        - in: path
          name: property
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PropertyInput'
      responses:
        '200': { description: Atualizado }
    delete:
      tags: [Properties]
      summary: Excluir propriedade
      parameters:
        - in: path
          name: property
          required: true
          schema: { type: string, format: uuid }
      responses:
        '204': { description: Excluída }
        '409': { description: Conflito - possui reservas vinculadas }

  /rooms/{room}/rates:
    get:
      tags: [Room Rates]
      summary: Tarifas base do quarto
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
        - in: path
          name: room
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200': { description: Lista }
    post:
      tags: [Room Rates]
      summary: Criar tarifa base
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
        - in: path
          name: room
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [people_count, price_per_day]
              properties:
                people_count: { type: integer }
                price_per_day: { type: number }
      responses:
        '201': { description: Criado }
  /room-rates/{rate}:
    put:
      tags: [Room Rates]
      summary: Atualizar tarifa base
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
        - in: path
          name: rate
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200': { description: Atualizado }
    delete:
      tags: [Room Rates]
      summary: Excluir tarifa base
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
        - in: path
          name: rate
          required: true
          schema: { type: string, format: uuid }
      responses:
        '204': { description: Excluído }
  /rooms/{room}/rate-periods:
    get:
      tags: [Room Rate Periods]
      summary: Tarifas por período do quarto
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
        - in: path
          name: room
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200': { description: Lista }
    post:
      tags: [Room Rate Periods]
      summary: Criar tarifa por período
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
        - in: path
          name: room
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [start_date, end_date, people_count, price_per_day]
              properties:
                start_date: { type: string, format: date }
                end_date: { type: string, format: date }
                people_count: { type: integer }
                price_per_day: { type: number }
      responses:
        '201': { description: Criado }
  /room-rate-periods/{period}:
    put:
      tags: [Room Rate Periods]
      summary: Atualizar período
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
        - in: path
          name: period
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200': { description: Atualizado }
    delete:
      tags: [Room Rate Periods]
      summary: Excluir período
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
        - in: path
          name: period
          required: true
          schema: { type: string, format: uuid }
      responses:
        '204': { description: Excluído }
  /room-categories/{category}/rates:
    get:
      tags: [Category Rates]
      summary: Tarifas base da categoria
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
        - in: path
          name: category
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200': { description: Lista }
    post:
      tags: [Category Rates]
      summary: Criar tarifa base da categoria
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
        - in: path
          name: category
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [people_count, price_per_day]
              properties:
                people_count: { type: integer }
                price_per_day: { type: number }
      responses:
        '201': { description: Criado }
  /room-category-rates/{rate}:
    put:
      tags: [Category Rates]
      summary: Atualizar tarifa base da categoria
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
        - in: path
          name: rate
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200': { description: Atualizado }
    delete:
      tags: [Category Rates]
      summary: Excluir tarifa base da categoria
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
        - in: path
          name: rate
          required: true
          schema: { type: string, format: uuid }
      responses:
        '204': { description: Excluído }
  /room-categories/{category}/rate-periods:
    get:
      tags: [Category Rate Periods]
      summary: Tarifas por período da categoria
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
        - in: path
          name: category
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200': { description: Lista }
    post:
      tags: [Category Rate Periods]
      summary: Criar tarifa por período da categoria
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
        - in: path
          name: category
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [start_date, end_date, people_count, price_per_day]
              properties:
                start_date: { type: string, format: date }
                end_date: { type: string, format: date }
                people_count: { type: integer }
                price_per_day: { type: number }
      responses:
        '201': { description: Criado }
  /room-category-rate-periods/{period}:
    put:
      tags: [Category Rate Periods]
      summary: Atualizar período da categoria
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
        - in: path
          name: period
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200': { description: Atualizado }
    delete:
      tags: [Category Rate Periods]
      summary: Excluir período da categoria
      parameters:
        - in: header
          name: X-Property-Id
          schema: { type: string, format: uuid }
          required: true
        - in: path
          name: period
          required: true
          schema: { type: string, format: uuid }
      responses:
        '204': { description: Excluído }

  /invoices:
    post:
      tags: [Partners]
      summary: Criar fatura
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [partner_id, lines]
              properties:
                partner_id: { type: string, format: uuid }
                property_id: { type: string, format: uuid }
                number: { type: string }
                issued_at: { type: string, format: date }
                due_at: { type: string, format: date }
                lines:
                  type: array
                  items:
                    type: object
                    required: [description, unit_price]
                    properties:
                      description: { type: string }
                      quantity: { type: integer }
                      unit_price: { type: number }
      responses:
        '201': { description: Fatura criada }

  /invoices/{invoice}:
    get:
      tags: [Partners]
      summary: Detalhe da fatura
      parameters:
        - in: path
          name: invoice
          schema: { type: string, format: uuid }
          required: true
      responses:
        '200': { description: Fatura }

  /invoices/{invoice}/payments:
    post:
      tags: [Partners]
      summary: Criar pagamento para fatura
      parameters:
        - in: path
          name: invoice
          schema: { type: string, format: uuid }
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [amount]
              properties:
                amount: { type: number }
                method: { type: string }
                paid_at: { type: string, format: date }
      responses:
        '201': { description: Pagamento criado }
