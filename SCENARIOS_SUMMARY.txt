â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    RESERVAS + FINANCEIRO - ANÃLISE COMPLETA                       â•‘
â•‘                          CenÃ¡rios Descobertos (20/02/2026)                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

RESULTADO DA ANÃLISE:
====================

âœ… COBERTO (Hoje + Fase 1):
  â€¢ CriaÃ§Ã£o de reserva (prÃ©-reserva)
  â€¢ ConfirmaÃ§Ã£o (reservado â†’ confirmado)
  â€¢ Check-in standard
  â€¢ Check-out standard
  â€¢ Cancelamento simples
  â€¢ Price override com auditoria
  â€¢ Minibar tracking
  â€¢ Invoice auto-creation

ğŸš¨ DESCOBERTO - CRÃTICO (Fase 2):
  â€¢ EARLY DEPARTURE: HÃ³spede sai antes. Recalc preÃ§o, reduz invoice, refund
  â€¢ GUEST MODIFICATION: CorreÃ§Ã£o de dados pÃ³s-check-in (typos, doc errado)
  â€¢ REFUND POLICY: % refund baseado em dias antes do check-in
  â€¢ MULTI-LINE INVOICE: Consolidar booking + minibar + extras em 1 invoice
  â€¢ FINALIZE: Lock guest data + preÃ§o apÃ³s check-out

âš ï¸  IMPORTANTE (Fase 2):
  â€¢ NO-SHOW: Novo status, possÃ­vel penalidade
  â€¢ PRICE RECALC ON EDIT: Editar datas â†’ recalc invoice
  â€¢ ROOM CHANGE: Trocar quarto mid-stay â†’ novo preÃ§o
  â€¢ LATE CHECKOUT: Prorrogar 2h â†’ taxa extra
  â€¢ PAYMENT STATUS SYNC: Update payment_status com invoice tracking

IMPACTO FNRH:
=============

SEM FASE 2 (Implementar FNRH agora):
  âŒ FNRH nÃ£o saberÃ¡ de early departures
  âŒ FNRH nÃ£o saberÃ¡ de guest modifications
  âŒ FNRH nÃ£o saberÃ¡ de refunds
  âŒ FNRH nÃ£o saberÃ¡ de preÃ§os ajustados
  âŒ Backend terÃ¡ lÃ³gica quebrada â†’ ficaremos remendando depois

COM FASE 2 COMPLETA (Depois implementar FNRH):
  âœ… FNRH terÃ¡ todos os cenÃ¡rios financeiros cobertos
  âœ… Backend pronto para qualquer scenario de reserva
  âœ… Audit trail completo para todas as mudanÃ§as
  âœ… FNRH Outbox pode enfileirar 6 stages (nÃ£o 3)
  âœ… Offline-first funciona 100% mesmo sem FNRH

NOVO ROADMAP (5 FASES):
=======================

FASE 1: RESERVAS CORE (Semana 1)
  Scope: PrÃ©-check-in minimal, check-in, checkout, cancelamento, audit
  Status: Exatamente como planejado antes
  Outputs: Backend + Frontend offline-funcional

FASE 2: RESERVAS EXTENDED + FINANCEIRO (Semana 2) ğŸš¨ NOVO
  Scope: Early departure, guest modification, no-show, finalize, refund, price recalc
  Status: CRÃTICO - implementar ANTES de FNRH
  Outputs: Todos os scenarios financeiros + audit + invoice extended

FASE 3: FINANCIAL INTEGRATION (Semana 2.5)
  Scope: Multi-line invoice, payment status, lock after send
  Status: ConsolidaÃ§Ã£o financeira
  Outputs: Financeiro integrado e consistente

FASE 4: FNRH OUTBOX (Semana 3) ğŸ¯ FNRH AGORA SIM
  Scope: Async queue com 6 stages (guest, checkin, checkout, early_dep, guest_upd, finalized)
  Status: Com cobertura completa de scenarios
  Outputs: FNRH pronto com dados completos

FASE 5: POLISH + DOCS (Semana 4)
  Scope: Error handling, perf, OpenAPI, ADRs, docs
  Status: FinalizaÃ§Ã£o
  Outputs: DocumentaÃ§Ã£o e polimento

ARQUIVOS ATUALIZADOS:
====================
  âœ… plan-fnrhHybridSyncFlow.prompt.md (seÃ§Ã£o "CenÃ¡rios de Reservas QUE NÃƒO TEMOS")
  âœ… plan-fnrhHybridSyncFlow.prompt.md (novo roadmap 5-fases)
  âœ… plan-fnrhHybridSyncFlow.prompt.md (Key Decisions atualizado)
  âœ… FNRH_SCENARIOS_ANALYSIS.md (anÃ¡lise detalhada - novo arquivo)
  âœ… TODO.md (8 fases planejadas)

RECOMENDAÃ‡ÃƒO FINAL:
==================
Implementar Fase 1 + Fase 2 antes de FNRH.
Seria corrigir depois financeiro serÃ¡ 10x mais caro.

